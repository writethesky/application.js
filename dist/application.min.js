/*! application.js v1.0.0 
 * https://github.com/writethesky 
 * https://github.com/writethesky/application.js 
 * 
 * Copyright (c) 2017 writethesky（撰天） 
 * Released under the MIT License. 
 * 
 * Date: 2017-03-17 */

!function(w){"use strict";function ajax(a,b,c,d){for(var e in settings.api)if(""===settings.api[e])return void console.info("在此之前请调用 api.settings 方法");var f={type:c,data:b,url:settings.api.location+"/"+a,dataType:"json",async:!0,xhrFields:{withCredentials:!0},crossDomain:!0,success:function(a){d&&d(a)}};switch(settings.api.versionSendType){case"url":f.url=settings.api.location+"/"+settings.api.version+"/"+a;break;case"param":f.data.version=settings.api.version;break;case"header":f.headers={"Api-Version":settings.api.version}}$.ajax(f)}function load_page(a,b){if(b)var c=b.html,d=b.container_id,e=b.css,f=b.js,g=b.obj;else{var c=$(this).attr("href"),d=$(this).attr("container"),e=$(this).attr("css"),f=$(this).attr("js"),g=$(this).attr("data-obj");g&&(g=g.replace(/'/g,'"'),g=$.parseJSON(g),w.dataObj=g),e=e?e.split("|"):"",f=f?f.split("|"):""}settings.isChangeURL&&w.history.pushState(null,null,c);var b={html:c,css:e,js:f,container_id:d,obj:g};return app.apphistory.push(b),e&&load.css(e,function(){$(window).resize(),c&&load.html(c,d,function(){$(window).resize(),f&&load.js(f)})}),!1}function load(){var __this=this;this.html=function(a,b,c){$.get(a+t,function(a){$("#"+b).html(a),c&&c()})},this.css=function(a,b){function c(){var c=a.slice(0);c.shift();__this.css;__this.css(c,b)}if(a.length>0){var d=a[0]+t,e=document.getElementsByTagName("HEAD").item(0),f=!0;if($("link").each(function(){var a=window.location.href.split("/"),b=a[a.length-1].length;window.location.href.substr(0,window.location.href.length-b)+d==this.href&&(f=!1)}),f){var g=document.createElement("link");g.href=d,g.rel="stylesheet",g.type="text/css",e.appendChild(g),cssReady(g,function(){c()})}else c()}else b&&b()},this.js=function(arr,callback){function construct(){var js_name=arr[0];js_name=js_name.replace(/\//g,"."),js_name=js_name.substr(0,js_name.length-3),eval("try{"+js_name+"&&"+js_name+"()} catch(e) {}");var tmp_arr=arr.slice(0);tmp_arr.shift();var tmp=__this.js;tmp(tmp_arr,callback)}var __js=this;if(arr.length>0){var src=arr[0]+t,body=document.getElementsByTagName("body").item(0),is_run=!0,script;$("script").each(function(){var a=window.location.href.split("/"),b=a[a.length-1].length;window.location.href.substr(0,window.location.href.length-b)+src==this.src&&(is_run=!1,script=this)}),is_run?(script=document.createElement("script"),script.src=src,script.type="text/javascript",body.appendChild(script),jsReady(script,function(){construct()})):construct()}else callback&&callback()}}function cssReady(a,b){function c(){try{return a&&a[g]&&a[g][f]&&a[g][f]}catch(a){return!1}}var d=document,e=d.createStyleSheet,f=e?"rules":"cssRules",g=e?"styleSheet":"sheet",h=d.getElementsByTagName("link");a||(a=h[h.length-1]),function a(){c()&&setTimeout(b,0)||setTimeout(a,100)}()}function jsReady(a,b){a.onload=a.onreadystatechange=function(){this.readyState&&"loaded"!=this.readyState&&"complete"!=this.readyState||(a.onload=a.onreadystatechange=null,setTimeout(b,0))}}function object_merge(a,b){for(var c in b)a.hasOwnProperty(c)&&"object"==typeof a[c]?"object"==typeof b[c]&&(a[c]=object_merge(a[c],b[c])):a[c]=b[c];return a}function is_html5(){var a=$("<canvas style='position: absolute; top: 0; z-index: -1;'/>");return $("body").append(a),!!a.get(0).getContext}if("undefined"==typeof $||void 0===$.fn||void 0===$.fn.jquery||$.fn.jquery<"3.1.1")return void console.info("请引入3.1.1版本以上的jQuery");if(!is_html5())return void $("body").html("<h1>您的内核版本太低</h1><br /><br /><h3>如果您正在使用的浏览器访问本站，建议升级您的浏览器</h3><br /><br /><h3>如果您正在使用手机等客户端打开本APP，建议您升级您的操作系统</h3>").css({background:"#fff",fontSize:".5rem",textAlign:"center"});var t="?t="+(new Date).getTime(),settings={api:{location:"",version:"",versionSendType:"url"},isChangeURL:!1},app={settings:function(a){settings=object_merge(settings,a)},api:{ajax:function(a,b,c,d){ajax(a,c,b,d)},get:function(a,b,c){ajax(a,b,"get",c)},post:function(a,b,c){ajax(a,b,"post",c)}},load_page:function(a){load_page.call(a)},back:function(){var a=app.apphistory.length-2;if(!(a<0)){load_page(null,app.apphistory[a]),app.apphistory.pop(),app.apphistory.pop()}},namespace:{register:function(path){for(var arr=path.split("."),ns="",i=0;i<arr.length;i++)i>0&&(ns+="."),ns+=arr[i],eval("if(typeof("+ns+") == 'undefined') window."+ns+" = new Object();")}}};$("html").on("click","a[app]",load_page),app.apphistory=[];var load=new load;w.getFormatDate=function(a){function b(a){return a<10?"0"+a:a}var c=new Date(1e3*a),d=c.getFullYear(),e=c.getMonth()+1,f=c.getDate();return d+"/"+b(e)+"/"+b(f)};var alert_message=function(a,b,c,d,e){b=b?b:"100%",c=c?c:"2rem",d=d?d:500,m_id="alert_"+(new Date).getTime(),b_height=$(window).height();var f=b_height/2,g="rgb(255, 116, 116)";switch(e){case"error":g="rgb(255, 116, 116)";break;case"success":g="#65e26e";break;default:g="rgb(255, 116, 116)"}var h=$("<div />").css({width:b,height:c,background:g,position:"fixed",zIndex:"9999",color:"#fff",textAlign:"center",lineHeight:c,top:b_height}).attr("id",m_id).text(a);$("body").append(h),h.animate({top:f},d),setTimeout(function(){h.remove()},d+2e3)};app.alert={error:function(a,b,c,d){alert_message(a,b,c,d,"error")},success:function(a,b,c,d){alert_message(a,b,c,d,"success")}},w.app=app}(window);
//# sourceMappingURL=application.min.map